# =============================================================================
# ğŸš€ Pre-commit Configuration - ä¼˜åŒ–ç‰ˆæœ¬
# =============================================================================
# ç§»é™¤äº†æœ‰é—®é¢˜çš„ä»“åº“å’Œé‡å¤åŠŸèƒ½ï¼Œä¸“æ³¨äºRusté¡¹ç›®çš„æ ¸å¿ƒä»£ç è´¨é‡æ§åˆ¶
# ä¿ç•™äº†æœ€ç¨³å®šå’Œå¿…è¦çš„å·¥å…·ï¼Œé¿å…åŠŸèƒ½é‡å 

fail_fast: false
exclude: |
  (?x)^(
      .*\.lock$|          # æ’é™¤é”æ–‡ä»¶
      target/.*|          # æ’é™¤æ„å»ºç›®å½•
      \.git/.*|           # æ’é™¤ git ç›®å½•
      .*\.bak$|           # æ’é™¤å¤‡ä»½æ–‡ä»¶
      .*\.tmp$            # æ’é™¤ä¸´æ—¶æ–‡ä»¶
  )$

default_language_version:
  python: python3

repos:
  # ==========================================================================
  #                           ğŸ”’ å®‰å…¨æ£€æŸ¥å·¥å…·
  # ==========================================================================

  # æ£€æµ‹ç¡¬ç¼–ç å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.27.2
    hooks:
      - id: gitleaks
        name: "ğŸ”’ å®‰å…¨ Â· æ£€æµ‹ç¡¬ç¼–ç å¯†é’¥"
        args: ['--verbose', '--redact', '--config', '.gitleaks.toml']

  # æ£€æµ‹ç§é’¥æ–‡ä»¶
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        name: "ğŸ”’ å®‰å…¨ Â· æ£€æµ‹å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯"
        args: ['--baseline', '.secrets.baseline']
        exclude: \.secrets\.baseline$

  # ==========================================================================
  #                          ğŸ“ æ–‡ä»¶ç³»ç»Ÿå’Œé€šç”¨æ£€æŸ¥
  # ==========================================================================

  # é¢„æäº¤å®˜æ–¹é’©å­é›†åˆ
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # æ–‡ä»¶æ ¼å¼æ£€æŸ¥
      - id: check-toml
        name: "ğŸ“ æ ¼å¼ Â· éªŒè¯ TOML æ–‡ä»¶è¯­æ³•"
      - id: check-yaml
        name: "ğŸ“ æ ¼å¼ Â· éªŒè¯ YAML æ–‡ä»¶è¯­æ³•"
        args: ['--allow-multiple-documents']
      - id: check-json
        name: "ğŸ“ æ ¼å¼ Â· éªŒè¯ JSON æ–‡ä»¶è¯­æ³•"
      - id: check-xml
        name: "ğŸ“ æ ¼å¼ Â· éªŒè¯ XML æ–‡ä»¶è¯­æ³•"
      - id: pretty-format-json
        name: "ğŸ“ æ ¼å¼ Â· ç¾åŒ– JSON æ–‡ä»¶æ ¼å¼"

      # Python ä»£ç æ£€æŸ¥ (ä¿ç•™ Ruff æœªè¦†ç›–çš„æ£€æŸ¥)
      - id: check-ast
        name: "ğŸ Python Â· æ£€æŸ¥ AST è¯­æ³•"
      # - id: check-builtin-literals   # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« Ruff è¦†ç›–
      # - id: check-docstring-first    # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« Ruff è¦†ç›–
      # - id: debug-statements         # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« Ruff è¦†ç›–
      # - id: double-quote-string-fixer # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« Ruff æ ¼å¼åŒ–è¦†ç›–
      - id: name-tests-test
        name: "ğŸ Python Â· æ£€æŸ¥æµ‹è¯•æ–‡ä»¶å‘½å"

      # æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥
      - id: check-case-conflict
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æŸ¥æ–‡ä»¶åå¤§å°å†™å†²çª"
      - id: check-executables-have-shebangs
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶æœ‰ shebang"
      - id: check-shebang-scripts-are-executable
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æŸ¥ shebang è„šæœ¬å¯æ‰§è¡Œ"
      - id: check-symlinks
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æŸ¥æŸåçš„ç¬¦å·é“¾æ¥"
      - id: destroyed-symlinks
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æµ‹è¢«ç ´åçš„ç¬¦å·é“¾æ¥"
      - id: check-illegal-windows-names
        name: "ğŸ“ ç³»ç»Ÿ Â· æ£€æŸ¥éæ³• Windows æ–‡ä»¶å"

      # Git å’Œç‰ˆæœ¬æ§åˆ¶æ£€æŸ¥
      - id: check-merge-conflict
        name: "ğŸŒ³ Git Â· æ£€æµ‹åˆå¹¶å†²çªæ ‡è®°"
      - id: check-added-large-files
        name: "ğŸŒ³ Git Â· é˜»æ­¢æäº¤å¤§æ–‡ä»¶"
        args: ['--maxkb=1024']
      - id: check-vcs-permalinks
        name: "ğŸŒ³ Git Â· æ£€æŸ¥ VCS æ°¸ä¹…é“¾æ¥"
      - id: forbid-new-submodules
        name: "ğŸŒ³ Git Â· ç¦æ­¢æ–°çš„å­æ¨¡å—"
      - id: forbid-submodules
        name: "ğŸŒ³ Git Â· ç¦æ­¢æ‰€æœ‰å­æ¨¡å—"
      # åˆ†æ”¯ä¿æŠ¤å·²ç¦ç”¨ï¼Œå…è®¸ç›´æ¥æäº¤åˆ°ä»»ä½•åˆ†æ”¯
      # - id: no-commit-to-branch
      #   name: "ğŸŒ³ Git Â· ä¿æŠ¤ä¸»åˆ†æ”¯"
      #   args: ['--branch', 'main', '--branch', 'master', '--branch', 'develop']

      # å®‰å…¨æ£€æŸ¥ (å·²ç”± gitleaks å’Œ detect-secrets è¦†ç›–)
      # - id: detect-aws-credentials  # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« gitleaks è¦†ç›–
      # - id: detect-private-key      # é‡å¤åŠŸèƒ½ï¼Œå·²è¢« detect-secrets è¦†ç›–

      # æ–‡ä»¶å†…å®¹æ¸…ç†
      - id: end-of-file-fixer
        name: "âœ¨ æ¸…ç† Â· ç¡®ä¿æ–‡ä»¶ä»¥æ¢è¡Œç¬¦ç»“å°¾"
      - id: trailing-whitespace
        name: "âœ¨ æ¸…ç† Â· åˆ é™¤è¡Œå°¾ç©ºç™½å­—ç¬¦"
        args: ['--markdown-linebreak-ext=md']
      - id: mixed-line-ending
        name: "âœ¨ æ¸…ç† Â· ç»Ÿä¸€è¡Œç»“æŸç¬¦"
        args: ['--fix=lf']
      - id: fix-byte-order-marker
        name: "âœ¨ æ¸…ç† Â· ä¿®å¤ UTF-8 å­—èŠ‚åºæ ‡è®°"

      # æ–‡ä»¶æ’åºå’Œç»„ç»‡
      - id: file-contents-sorter
        name: "ğŸ“‹ ç»„ç»‡ Â· æ–‡ä»¶å†…å®¹æ’åº"
        files: '^$'  # é»˜è®¤ä¸åŒ¹é…ä»»ä½•æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®
      - id: sort-simple-yaml
        name: "ğŸ“‹ ç»„ç»‡ Â· æ’åºç®€å• YAML æ–‡ä»¶"
        files: '^$'  # é»˜è®¤ä¸åŒ¹é…ä»»ä½•æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®
      - id: requirements-txt-fixer
        name: "ğŸ“‹ ç»„ç»‡ Â· ä¿®å¤ requirements.txt"

  # ==========================================================================
  #                            ğŸ¦€ Rust ä¸“ç”¨å·¥å…·
  # ==========================================================================

  - repo: local
    hooks:
      # ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
      - id: cargo-fmt
        name: "ğŸ¦€ Rust Â· ä»£ç æ ¼å¼åŒ–æ£€æŸ¥"
        description: "ä½¿ç”¨ rustfmt æ£€æŸ¥ä»£ç æ ¼å¼"
        entry: bash -c 'cargo fmt --all -- --check'
        language: rust
        files: \.rs$
        pass_filenames: false

      # ç¼–è¯‘æ£€æŸ¥
      - id: cargo-check
        name: "ğŸ¦€ Rust Â· ç¼–è¯‘æ£€æŸ¥"
        description: "æ£€æŸ¥ä»£ç æ˜¯å¦èƒ½æ­£å¸¸ç¼–è¯‘"
        entry: bash -c 'cargo check --all-targets --all-features'
        language: rust
        files: \.rs$
        pass_filenames: false

      # Clippy ä»£ç è´¨é‡æ£€æŸ¥
      - id: cargo-clippy
        name: "ğŸ¦€ Rust Â· Clippy ä»£ç è´¨é‡æ£€æŸ¥"
        description: "ä½¿ç”¨ Clippy è¿›è¡Œä»£ç è´¨é‡åˆ†æ"
        entry: bash -c 'cargo clippy --all-targets --all-features -- -D warnings'
        language: rust
        files: \.rs$
        pass_filenames: false

      # ä¾èµ–å®‰å…¨æ£€æŸ¥
      - id: cargo-deny
        name: "ğŸ¦€ Rust Â· ä¾èµ–å®‰å…¨æ£€æŸ¥"
        description: "æ£€æŸ¥ä¾èµ–çš„å®‰å…¨æ€§å’Œè®¸å¯è¯"
        entry: bash -c 'cargo deny check'
        language: rust
        files: \.rs$|Cargo\.toml$|Cargo\.lock$
        pass_filenames: false

      # å•å…ƒæµ‹è¯•
      - id: cargo-test
        name: "ğŸ¦€ Rust Â· è¿è¡Œå•å…ƒæµ‹è¯•"
        description: "è¿è¡Œé¡¹ç›®çš„å•å…ƒæµ‹è¯•"
        entry: bash -c 'cargo nextest run --all-features'
        language: rust
        files: \.rs$
        pass_filenames: false

      # æ–‡æ¡£ç”Ÿæˆæ£€æŸ¥
      - id: cargo-doc
        name: "ğŸ¦€ Rust Â· æ–‡æ¡£ç”Ÿæˆæ£€æŸ¥"
        description: "æ£€æŸ¥æ–‡æ¡£æ˜¯å¦èƒ½æ­£å¸¸ç”Ÿæˆ"
        entry: bash -c 'cargo doc --no-deps --document-private-items'
        language: rust
        files: \.rs$
        pass_filenames: false

      # è‡ªåŠ¨ç”Ÿæˆ/æ›´æ–° CHANGELOG.md
      - id: git-cliff-changelog
        name: "ğŸ“ ç”Ÿæˆ CHANGELOG.md"
        description: "ä½¿ç”¨ git-cliff è‡ªåŠ¨ç”Ÿæˆ/æ›´æ–° CHANGELOG.md"
        entry: bash -c 'git cliff -o CHANGELOG.md'
        language: system
        pass_filenames: false
        always_run: true

      # æ‹¼å†™æ£€æŸ¥
      - id: typos
        name: "ğŸ” æ‹¼å†™ Â· æ£€æŸ¥ä»£ç å’Œæ–‡æ¡£ä¸­çš„æ‹¼å†™é”™è¯¯"
        description: "ä½¿ç”¨ typos æ£€æŸ¥æ‹¼å†™é”™è¯¯"
        entry: typos
        language: rust
        files: \.*$
        pass_filenames: false
        args: ['--format=brief']

  # ==========================================================================
  #                            ğŸ Python ä¸“ç”¨å·¥å…· (åŸºç¡€ç‰ˆæœ¬)
  # ==========================================================================

  # Ruff - ç°ä»£ Python ä»£ç æ ¼å¼åŒ–å’Œé™æ€æ£€æŸ¥å·¥å…·
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.12.2
    hooks:
      # Python ä»£ç æ ¼å¼åŒ–
      - id: ruff-format
        name: "ğŸ Python Â· ä»£ç æ ¼å¼åŒ–"
        description: "ä½¿ç”¨ Ruff æ ¼å¼åŒ– Python ä»£ç "

      # Python ä»£ç æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤
      - id: ruff
        name: "ğŸ Python Â· ä»£ç æ£€æŸ¥å’Œä¿®å¤"
        description: "ä½¿ç”¨ Ruff è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤"
        args: ['--fix']

  # Python å¯¼å…¥æ’åº
  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        name: "ğŸ Python Â· å¯¼å…¥æ’åº"
        description: "ä½¿ç”¨ isort æ’åºå’Œæ ¼å¼åŒ–å¯¼å…¥è¯­å¥"
        args: ['--profile', 'black', '--line-length', '88']

  # ==========================================================================
  #                           ğŸ“Š é…ç½®æ–‡ä»¶éªŒè¯
  # ==========================================================================

  # Markdown è¯­æ³•æ£€æŸ¥
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.45.0
    hooks:
      - id: markdownlint
        name: "ğŸ“ Markdown Â· è¯­æ³•æ£€æŸ¥"
        args: ['--fix']
